name = "cityjobs"
main = "src/index.ts"
compatibility_date = "2024-12-05"

# Shared config
[vars]
SOCRATA_BASE_URL = "https://data.cityofnewyork.us"
SOCRATA_DATASET_ID = "kpav-sd4t"

# Secrets (set via wrangler secret put):
# - SOCRATA_APP_KEY_ID
# - SOCRATA_APP_KEY_SECRET

# ============================================================
# Development environment: npm run dev
# ============================================================
[env.dev]
[env.dev.vars]
SOCRATA_BASE_URL = "https://data.cityofnewyork.us"
SOCRATA_DATASET_ID = "kpav-sd4t"

[[env.dev.r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "cityjobs-data-dev"
preview_bucket_name = "cityjobs-data-dev"

[[env.dev.d1_databases]]
binding = "D1_DATABASE"
database_name = "cityjobs-db"
database_id = "9e991c1c-5753-4bca-af6f-337b475793dc"
preview_database_id = "9e991c1c-5753-4bca-af6f-337b475793dc"

# ============================================================
# Production environment: npm run deploy
# ============================================================
[env.production]
[env.production.vars]
SOCRATA_BASE_URL = "https://data.cityofnewyork.us"
SOCRATA_DATASET_ID = "kpav-sd4t"

[env.production.triggers]
crons = ["0 4 * * *"]  # Daily at 4am UTC

[[env.production.r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "cityjobs-data"

[[env.production.d1_databases]]
binding = "D1_DATABASE"
database_name = "cityjobs-db"
database_id = "9e991c1c-5753-4bca-af6f-337b475793dc"
